---
title: C 语言数据存储基础
date: 2023-09-25 21:55:00
index_img: /img/post-4.png
tags: 数据存储png
---

> 本文介绍 C 语言数据存储的详细内容。

## 1. 数据类型

### 1.1 类型的基本归类

C语言中有多种基本数据类型，包括整数、浮点数、字符等。这些数据类型在内存中占用的空间大小不同，例如，int通常占用4个字节，float占用4个字节，char占用1个字节。数据类型决定了数据在内存中的存储方式和表示形式，可以分为以下的五大类型：

### 1.1.1 整型

```c
char
	unsigned char
	signed char
short
	unsigned short [int]
	signed short [int]
int 
	unsigned int
	signed int
long
	unsigned long
	signed long [int]
```

### 1.1.2 浮点型

```c
float
double
```

### 1.1.3 构造类型

```c
array // 数组类型
struct // 结构体类型 
enum // 枚举类型 
union // 联合类型
```

### 1.1.4 指针类型

```
int *ptr
char *ptr
float *ptr
void *ptr
```

### 1.1.5 空类型

```
void // 函数参数、返回类型、指针
```

## 2. 整形在内存中的存储

C 变量的创建是根据数据类型在内存中开辟空间。

### 2.1 原码、反码、补码

数据在内存中以 2 进制的形式存储，以整数举例，其 2 进制存储有三种表示形式。

正整数：原码、反码、补码相同。

负整数：原码、反码、补码要进行计算。

举例代码：

```
int a = -10;
// 10000000 00000000 00000000 00001010 - 原码（原始 2 进制表示形式）
// 11111111 11111111 11111111 11110101 - 反码（符号位不变，其它位按位取反）
// 11111111 11111111 11111111 11110110 - 补码（反码 + 1）
```

VS Code 调试取 `&a` 的地址后可以观察发现 16 进制的内存地址所存储的数据为 `F6 FF FF FF`，这恰好是 2 进制补码的 16 进制数，同时表明了整数在内存中存储的是补码。

{% asset_img 1.png %}

<br/>

<br/>

> 为什么数据在内存中存放的是补码：因为在计算机组成原理中，补码可以将符号位和数值域统一处理，加法和减法也可以统一处理（CPU只有加法器），此外补码和原码相互转换，运算过程是相同的，无需额外的逻辑硬件电路。

举例代码：

```c
int main()
{
	// 1 - 1;
	// 1 + (-1);
	// 00000000 00000000 00000000 00000001 - 1的原码
	// 10000000 00000000 00000000 00000001 - -1的原码
    // 如果计算机采用原码进行逻辑加减（1+（-1）），得到结果数值如下
    // 10000000 00000000 00000000 00000010 - 是-2？可以看到数值是错误的。
	// 如果采用补码运算，数值才是正确的，这是计算机组成底层原理的逻辑。
}
```

### 2.2 大端字节序和小端字节序

字节序（Byte Order）是指多字节数据在计算机内存中存储时的顺序。字节序分为两种主要类型：大端字节序（Big-Endian）和小端字节序（Little-Endian）。

1. **大端字节序（Big-Endian）**：

   - 在大端字节序中，多字节数据的最高有效字节（Most Significant Byte，MSB）存储在内存的最低地址处，而最低有效字节（Least Significant Byte，LSB）存储在内存的最高地址处。
   - 大端字节序的表示方式类似于阅读书写的方式，先读取最高位的字节，然后是次高位，以此类推。

   例如，十六进制数0x12345678在大端字节序中存储为：

   ```c
   0x12 0x34 0x56 0x78
   ```
   
2. **小端字节序（Little-Endian）**：

   - 在小端字节序中，多字节数据的最低有效字节（LSB）存储在内存的最低地址处，而最高有效字节（MSB）存储在内存的最高地址处。
   - 小端字节序的表示方式与计算机内部的数据存储方式相符，因此在许多计算机架构中使用较为广泛。

   例如，十六进制数0x12345678在小端字节序中存储为：

   ```C
   0x78 0x56 0x34 0x12
   ```

字节序的选择在不同计算机架构和操作系统中可以有所不同。例如，x86 和 x86-64 架构通常使用小端字节序，而某些大型服务器架构（如SPARC）使用大端字节序。这种差异可能会在数据交换和网络通信中引起问题，因此在跨平台应用程序中，需要特别注意字节序的处理，以确保数据正确解释和传递。通常使用一种标准的字节序协议（如网络字节序）来协调不同架构之间的数据交换。
